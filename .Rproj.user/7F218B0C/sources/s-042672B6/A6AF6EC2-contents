---
title: "Untitled"
author: "Cheng Hua"
date: "7/3/2021"
output: html_document
---

```{r}
library(haven)
Ori_data <- read_sav("~/Downloads/REEP_Survey_Final Apr 29 2016_Renamed.sav")
View(Ori_data)
```

## Clean the data

```{r}
# Select the data we need
target_data <- Ori_data[,c(2,204:225,234:236)]
colnames(target_data) <- c("School_ID",1:22,"Teach_Year","Edu_level","Gender")
# Remove observations has more than 5 missing values
cnt_na <- apply(target_data, 1, function(z) sum(is.na(z)))
cleaned_data <- target_data[cnt_na<5,]
summary(cleaned_data)
# Omit the missing data
clean_data <- na.omit(target_data)
1# Take out the response matrix
clean_matrix <- clean_data[,c(3:24)]
# After kicking out all the observations contains missing value, we still have 1322 completed observations left which still will be regarded as a decent number of our analysis.
```




## Many-facet Rasch Model

### Prepare the data set
```{r}
# Add an ID column for TL clean data
# 
Response <- clean_data[,2:23]
ID <- c(1:1401)
Teacher_Leadership_ID <- cbind(ID,Response)
# Build a long list for response matrix
library(reshape)
mdata <- melt(Teacher_Leadership_ID, id=c("ID"))
# sort by ID
library(dplyr)
ordered_mdata <- arrange(mdata,mdata$ID)
# Rename column "variable" to "Item"
ordered_mdata$item <- ordered_mdata$variable

ordered_mdata <- cbind.data.frame(ordered_mdata$ID,
                                  ordered_mdata$variable,
                                  ordered_mdata$value)
# Adding a component column
comp_list <- c(1,1,1,1,2,2,2,2,2,2,3,3,3,3,3,4,4,4,4,4,4,4)
component <- rep(comp_list,1401)
# Adding gender column
TL_gender <- rep(clean_data$Gender,each=22)
# Adding Teacher_year column
TL_TY <- rep(clean_data$Teach_Year,each=22)
# Adding Education_background column
TL_EB <- rep(clean_data$Edu_level,each=22)
```

```{r}
# Build the dataset Gender+Component
MFR_GC <- cbind(ordered_mdata,component,TL_gender)
colnames(MFR_GC)
MFR_GC <- MFR_GC[, c(1, 5, 4, 2, 3)]
MFR_GC$`ordered_mdata$variable` <- as.integer(MFR_GC$`ordered_mdata$variable`)   
write.csv(MFR_GC,"MFR_GC",row.names=FALSE)

MFR_TC <- cbind(ordered_mdata,component,TL_TY)
# Reorder the dataset
# Get column names
colnames(MFR_TC)
MFR_TC <- MFR_TC[, c(1, 5, 4, 2, 3)]
MFR_TC$`ordered_mdata$variable` <- as.integer(MFR_TC$`ordered_mdata$variable`)   
write.csv(MFR_TC,"MFR_TC",row.names=FALSE)
```

```{r}
# Build the dataset Education_background+Component
MFR_EB <- cbind(ordered_mdata,component,TL_EB)
# Reorder the dataset
# Get column names
colnames(MFR_EB)
MFR_EB <- MFR_EB[, c(1, 5, 4, 2, 3)]
MFR_EB$`ordered_mdata$variable` <- as.integer(MFR_EB$`ordered_mdata$variable`) 
write.csv(MFR_EB,"MFR_EB",row.names=FALSE)
```